services:
  nginx:
    image: openresty/openresty:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx_proxy/nginx.conf:/usr/local/openresty/nginx/conf/nginx.conf
      - ./nginx_proxy/ssl/server.key:/etc/nginx/ssl/private/server.key
      - ./nginx_proxy/ssl/sirienergy_uab_cat.pem:/etc/nginx/ssl/private/sirienergy_uab_cat.pem
    container_name: nginx_proxy

  test_ms1:
    build:
      context: ./test_ms1
    volumes:
      - ./test_ms1/app.py:/app/app.py
    container_name: test_ms1

  user:
    build: ./user_ms
    env_file:
      - ./user_ms/.env
    volumes:
      - ./user_ms/app.py:/app/app.py
    depends_on:
      - user_db
    container_name: user

  user_db:
    image: postgres:15-alpine
    env_file:
      - ./user_ms/.env
    volumes:
      - userdb_data:/var/lib/postgresql/data
    container_name: user_db

volumes:
  userdb_data: